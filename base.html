<!doctype html>
<html><head>
<meta charset="utf-8">
<title>Using jQuery with the DPLA</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" title="no title" charset="utf-8">
</head><body>
<h1>Using jQuery with the DPLA</h1>
<form id="searchForm"><fieldset><legend>Search DPLA</legend>
<input type="hidden" name="search_type" value="keyword" />
<input type="hidden" name="limit" value="20" />
<label>Keyword: <input type="text" name="query" placeholder="a keyword" /></label> <input type="submit" value="Search" />
</fieldset></form>
<div id="results"></div>
<div id="subjectHeadings"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="js/d3.v2.js"></script>

<script>
jQuery(document).ready(function($){
	var $searchForm = $("#searchForm");
	$searchForm.on("submit",function(e){
		var submit = $searchForm.find('[type="submit"]').attr("disabled","disabled"),
			params = $searchForm.serialize(),
			subjectHeadings = d3.select("#subjectHeadings").attr("class", "chart");
			
		$.getJSON("http://api.dp.la/dev/item/?" + params + "&facet=subject&facet=language&facet=creator&callback=?")
			.done(function(data){
				var facets = {};
				
				$.each(['subject', 'creator', 'language'], function(i, facetName){
					
					facets[facetName+'s'] = [];
					var currentFacet = facets[facetName+'s'];
					
					for(key in data.facets[facetName]) {
						currentFacet.push({
							title: key,
							count: data.facets[facetName][key]
						});
					}
					
					
				});
				
				
				
				subjectHeadings.selectAll('div').data(facets.subjects)
				.enter().append('div')
				.style("width", function(d){ return d.count * 10 + 'px'; })
				.text(function(d){ return d.title });
				
			})
			.fail(function(){
				alert('Glaring error');
				})
			.always(function(){
				submit.removeAttr("disabled");
				});
		return false;
		});
	});
</script>
</body></html>